<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reference Guide 2.0.x | Boot Plus</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/boot-plus/icon.png">
    <meta name="description" content="让开发者更关注业务">
    
    <link rel="preload" href="/boot-plus/assets/css/0.styles.324e796a.css" as="style"><link rel="preload" href="/boot-plus/assets/js/app.21260ec8.js" as="script"><link rel="preload" href="/boot-plus/assets/js/2.7b2df435.js" as="script"><link rel="preload" href="/boot-plus/assets/js/12.24b48ba6.js" as="script"><link rel="prefetch" href="/boot-plus/assets/js/10.6e76b5ae.js"><link rel="prefetch" href="/boot-plus/assets/js/11.47bd483f.js"><link rel="prefetch" href="/boot-plus/assets/js/3.d7d6cdd2.js"><link rel="prefetch" href="/boot-plus/assets/js/4.09ee8a39.js"><link rel="prefetch" href="/boot-plus/assets/js/5.74820b6e.js"><link rel="prefetch" href="/boot-plus/assets/js/6.aa86b854.js"><link rel="prefetch" href="/boot-plus/assets/js/7.75516ed5.js"><link rel="prefetch" href="/boot-plus/assets/js/8.8b0fd735.js"><link rel="prefetch" href="/boot-plus/assets/js/9.1ffbf3c7.js">
    <link rel="stylesheet" href="/boot-plus/assets/css/0.styles.324e796a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/boot-plus/" class="home-link router-link-active"><!----> <span class="site-name">Boot Plus</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/boot-plus/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boot-plus/guide/latest/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  最新
</a></li><li class="dropdown-item"><!----> <a href="/boot-plus/guide/1_2/" class="nav-link">
  1.2.8
</a></li><li class="dropdown-item"><!----> <a href="/boot-plus/guide/1_3/" class="nav-link">
  1.3.10
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zhouxx/boot-plus/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新日志
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zhouxx/boot-plus/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/boot-plus/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文档" class="dropdown-title"><span class="title">文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="文档" class="mobile-dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/boot-plus/guide/latest/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  最新
</a></li><li class="dropdown-item"><!----> <a href="/boot-plus/guide/1_2/" class="nav-link">
  1.2.8
</a></li><li class="dropdown-item"><!----> <a href="/boot-plus/guide/1_3/" class="nav-link">
  1.3.10
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zhouxx/boot-plus/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新日志
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/zhouxx/boot-plus/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Reference Guide 2.0.x</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/boot-plus/guide/latest/#part1-简介" class="sidebar-link">Part1 : 简介</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/boot-plus/guide/latest/#part2-新版本特性" class="sidebar-link">Part2 :  新版本特性</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/boot-plus/guide/latest/#part3-起步" class="sidebar-link">Part3 : 起步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_3-1-系统要求" class="sidebar-link">3.1 系统要求</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_3-2-maven-依赖" class="sidebar-link">3.2 Maven 依赖</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_3-3-开发第一个应用" class="sidebar-link">3.3 开发第一个应用</a></li></ul></li><li><a href="/boot-plus/guide/latest/#part4-boot-plus-core" class="sidebar-link">Part4 : boot-plus-core</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#启动类-com-appstart" class="sidebar-link">启动类：com.AppStart</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#工具类-beanutils" class="sidebar-link">工具类：BeanUtils</a></li></ul></li><li><a href="/boot-plus/guide/latest/#part5-boot-plus-routing-datasource" class="sidebar-link">Part5 boot-plus-routing-datasource</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_5-1-配置多数据源" class="sidebar-link">5.1 配置多数据源</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_5-2-加密密码解析" class="sidebar-link">5.2 加密密码解析</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_5-3-动态添加-移除数据源" class="sidebar-link">5.3 动态添加/移除数据源</a></li></ul></li><li><a href="/boot-plus/guide/latest/#part6-boot-plus-web" class="sidebar-link">Part6 boot-plus-web</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_6-1-跨域支持" class="sidebar-link">6.1 跨域支持</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_6-2-jackson序列化扩展" class="sidebar-link">6.2 Jackson序列化扩展</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_6-3-流处理" class="sidebar-link">6.3 流处理</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_6-4-参数校验" class="sidebar-link">6.4 参数校验</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_6-5-系统异常处理" class="sidebar-link">6.5 系统异常处理</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_6-6-基于请求的threadlocal管理" class="sidebar-link">6.6 基于请求的ThreadLocal管理</a></li></ul></li><li><a href="/boot-plus/guide/latest/#part7-boot-plus-log" class="sidebar-link">Part7 boot-plus-log</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_7-1-对controller进行切面控制" class="sidebar-link">7.1 对Controller进行切面控制</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_7-2-管理日志级别" class="sidebar-link">7.2 管理日志级别</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_7-3-基于线程的日志打印" class="sidebar-link">7.3 基于线程的日志打印</a></li></ul></li><li><a href="/boot-plus/guide/latest/#part8-boot-plus-swagger" class="sidebar-link">Part8 boot-plus-swagger</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/boot-plus/guide/latest/#part9-boot-plus-security" class="sidebar-link">Part9 boot-plus-security</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_9-1-jwt" class="sidebar-link">9.1 JWT</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_9-2-stateful-token-有状态token" class="sidebar-link">9.2 Stateful Token（有状态token)</a></li><li class="sidebar-sub-header"><a href="/boot-plus/guide/latest/#_9-3-如何开发" class="sidebar-link">9.3 如何开发</a></li></ul></li><li><a href="/boot-plus/guide/latest/#part10-boot-plus-cache" class="sidebar-link">Part10 boot-plus-cache</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="reference-guide-2-0-x"><a href="#reference-guide-2-0-x" class="header-anchor">#</a> Reference Guide 2.0.x</h1> <h2 id="part1-简介"><a href="#part1-简介" class="header-anchor">#</a> Part1 : 简介</h2> <p>Boot Plus 是基于spring boot 的增强，但并未修改SpringBoot已有的功能，也就是说完全可以兼容使用SpringBoot的项目。可以任意使用其中一个模块的增强，而不必引入所有模块。让spring boot的使用者更好地关注于业务。</p> <p>主要增强以下几个方面：</p> <ul><li>dynamic datasource based on aop</li> <li>cache: spring cache enhancement</li> <li>web: json serialize enhancement, cros , validation enhancement</li> <li>log management online</li> <li>swagger(api online)</li> <li>security integration: more simple, support JWT &amp; Stateful Token</li></ul> <h2 id="part2-新版本特性"><a href="#part2-新版本特性" class="header-anchor">#</a> Part2 :  新版本特性</h2> <p>从2.0.0版本开始，做了一些模块上的重构：</p> <ul><li>移除了mybatis-jpa及相关的generator，单独维护至mybatis-jpa-parent</li> <li>同时也升级了spring boot 版本号至 <strong>2.3.12.RELEASE</strong> ，与 spring cloud  <strong>Hoxton.SR12</strong> 的版本号保持一致</li> <li>swaager移除了文档导出</li></ul> <h2 id="part3-起步"><a href="#part3-起步" class="header-anchor">#</a> Part3 : 起步</h2> <h3 id="_3-1-系统要求"><a href="#_3-1-系统要求" class="header-anchor">#</a> 3.1 系统要求</h3> <p>Boot Plus 1.3.x 至少要求java1.8，Spring Boot 2.3.12.RELEASE.</p> <h3 id="_3-2-maven-依赖"><a href="#_3-2-maven-依赖" class="header-anchor">#</a> 3.2 Maven 依赖</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alilitech<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>boot-plus-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_3-3-开发第一个应用"><a href="#_3-3-开发第一个应用" class="header-anchor">#</a> 3.3 开发第一个应用</h3> <h4 id="_3-3-1-创建pom"><a href="#_3-3-1-创建pom" class="header-anchor">#</a> 3.3.1 创建pom</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>myproject<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alilitech<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>boot-plus-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alilitech<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>boot-plus-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alilitech<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>boot-plus-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.x<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>你可以通过IDE指定启动类：<code>com.AppStart</code>来启动项目，也可以通过自定义启动类启动项目。</p> <h4 id="_3-3-2-创建一个可执行的jar"><a href="#_3-3-2-创建一个可执行的jar" class="header-anchor">#</a> 3.3.2 创建一个可执行的jar</h4> <p>需要添加 spring-boot-maven-plugin 至 pom.xml :</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span>com.AppStart<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>repackage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>至此，你已成功搭建和部署一个项目了。</p> <h2 id="part4-boot-plus-core"><a href="#part4-boot-plus-core" class="header-anchor">#</a> Part4 : boot-plus-core</h2> <p>提供了基于spring的依赖（没有web），可用于项目只执行一次就结束进程的（比如云原生的定时任务）。提供了以下功能：</p> <h3 id="启动类-com-appstart"><a href="#启动类-com-appstart" class="header-anchor">#</a> 启动类：<code>com.AppStart</code></h3> <p>启动时更优雅地打印更多信息，包括本地地址，当前IP地址等。</p> <h3 id="工具类-beanutils"><a href="#工具类-beanutils" class="header-anchor">#</a> 工具类：<code>BeanUtils</code></h3> <p>更高效的深度拷贝。父类属性，组合属性都可一并拷贝。常用于Entity与DTO之间的对象拷贝，提高开发效率。</p> <div class="custom-block tip"><p class="custom-block-title">特性</p> <ul><li>源对象可以继承，可以组合。父类的属性、组合对象的属性可以一并拷贝至目标对象，无需二次赋值</li> <li>基于属性反射+Getter/Setter方法进行拷贝（理论上可以在拷贝的时候重写源对象属性的Getter方法从而转换成需要的值，但不建议这么做）</li> <li>反射比较耗时，第一次反射后，启用了缓存，避免频繁反射带来的开销</li> <li>忽略源对象的属性。如果源对象的属性（包括组合对象）可能会有属性重复，但实现拷贝时只需要一个属性，如果不忽略某些属性，可能会造成目标对象属性值的覆盖。(下面会详解如何忽略)</li></ul></div> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>源对象和目标对象属性名称和属性类型要完全一致，否则无法拷贝，造成值丢失</p></div> <div class="custom-block tip"><p class="custom-block-title">如何忽略源对象属性</p> <p>比如有个组合类如下</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> userId<span class="token punctuation">;</span>
    
    <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    
    <span class="token class-name">Date</span> createdTime<span class="token punctuation">;</span>
    
    <span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">;</span>
    
    <span class="token comment">// getter &amp; setter</span>
    
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> userInfoId<span class="token punctuation">;</span>
    
    <span class="token class-name">String</span> userId<span class="token punctuation">;</span>
    
    <span class="token class-name">Date</span> createdTime<span class="token punctuation">;</span>
    
    <span class="token comment">// getter &amp; setter</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>在用工具类拷贝的时候，UserInfo的createdTime可以会覆盖User对象的createdTime。</p> <p>想要忽略<code>UserInfo</code>的<code>createdTime</code>，可以如下使用</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// simleName.property，注意大小写</span>
<span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyPropertiesDeep</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">UserDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;UserInfo.createdTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果想忽略<code>User</code>的<code>createdTime</code>，可以如下使用</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 源对象最外层的类名可以省略</span>
<span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyPropertiesDeep</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">UserDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;createdTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或</span>
<span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyPropertiesDeep</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">UserDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">&quot;User.createdTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <h2 id="part5-boot-plus-routing-datasource"><a href="#part5-boot-plus-routing-datasource" class="header-anchor">#</a> Part5 boot-plus-routing-datasource</h2> <p>动态数据源是指在项目里可以配置多个数据源，并且可以在不同的地方指定使用不同的数据源。</p> <p>此多数据源的实现未依赖于任何一个持久化的框架，所以一般于用于多库多service。想在同一个事务里操作多个数据源暂时无法实现。</p> <h3 id="_5-1-配置多数据源"><a href="#_5-1-配置多数据源" class="header-anchor">#</a> 5.1 配置多数据源</h3> <p>主数据源还和原来的方式一样，当未指定数据源或找不到指定的数据源时使用主数据源。主数据源的标识是<code>default</code>。
其它数据源标识要以<code>ds</code>开头，否则无法识别。配置方式和spring boot的方式一样。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/test
    <span class="token key atrule">username</span><span class="token punctuation">:</span> test
    <span class="token key atrule">password</span><span class="token punctuation">:</span> MyNewPass4<span class="token tag">!</span>
    <span class="token key atrule">ds-second</span><span class="token punctuation">:</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/test1
      <span class="token key atrule">username</span><span class="token punctuation">:</span> test
      <span class="token key atrule">password</span><span class="token punctuation">:</span> MyNewPass4<span class="token tag">!</span> 
</code></pre></div><p>代码里动态使用数据源的方式采用注解，一般在service层。比如：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@DynamicSource</span><span class="token punctuation">(</span><span class="token string">&quot;ds-second&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">exeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-2-加密密码解析"><a href="#_5-2-加密密码解析" class="header-anchor">#</a> 5.2 加密密码解析</h3> <p>部分在配置文件里的密码是加密的，但在连数据的时候需要明文。所以提供了<code>EncryptPropertyResolver</code>来解析。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyEncryptPropertyResolver</span> <span class="token keyword">implements</span> <span class="token class-name">EncryptPropertyResolver</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supportResolve</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;spring.datasource.ds-second.password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-3-动态添加-移除数据源"><a href="#_5-3-动态添加-移除数据源" class="header-anchor">#</a> 5.3 动态添加/移除数据源</h3> <p>代码里可以动态地创建数据源，并添加到多数据源里。</p> <p>我们可以拿到数据源对象，判断是否是<code>DefaultDynamicDataSource</code>此类，可以调用此类的<code>addDataSource</code>方法。一般用于数据源实时动态修改切换。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//add datasource</span>
defaultDynamicDataSource<span class="token punctuation">.</span><span class="token function">addDataSource</span><span class="token punctuation">(</span>datasourceName<span class="token punctuation">,</span> datasourceUrl<span class="token punctuation">,</span> datasourceUsername<span class="token punctuation">,</span> datasourcePassword<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//remove datasource</span>
defaultDynamicDataSource<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>datasourceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="part6-boot-plus-web"><a href="#part6-boot-plus-web" class="header-anchor">#</a> Part6 boot-plus-web</h2> <h3 id="_6-1-跨域支持"><a href="#_6-1-跨域支持" class="header-anchor">#</a> 6.1 跨域支持</h3> <p>跨域只需要在application.yml里配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">mvc</span><span class="token punctuation">:</span>
  <span class="token key atrule">cors</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>              
    <span class="token key atrule">path</span> <span class="token punctuation">:</span> <span class="token string">&quot;/**&quot;</span>               
    <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>        
    <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
    <span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">maxAge</span><span class="token punctuation">:</span> <span class="token number">3600</span>
    <span class="token key atrule">exposedHeaders</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> message
</code></pre></div><ul><li>enabled： 是否启用跨域</li> <li>path： 哪些URL可以跨域</li> <li>allowedOrigins： 哪些域名可以请求跨域，逗号隔开</li> <li>allowedMethods： 哪些方法可以跨域 POST, GET, PUT, DELETE, OPTIONS</li> <li>allowCredentials</li> <li>maxAge</li> <li>exposedHeaders：跨域时哪些头部信息返回</li></ul> <h3 id="_6-2-jackson序列化扩展"><a href="#_6-2-jackson序列化扩展" class="header-anchor">#</a> 6.2 Jackson序列化扩展</h3> <h4 id="_6-2-1-null值处理"><a href="#_6-2-1-null值处理" class="header-anchor">#</a> 6.2.1 null值处理</h4> <p>对于部分null值，前端展示不友好，又不能直接去掉，若在业务里处理量大且麻烦，通过配置或注解可以解决此问题。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">mvc</span><span class="token punctuation">:</span>
  <span class="token key atrule">json</span><span class="token punctuation">:</span>
    <span class="token key atrule">defaultNull</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">defaultNullValue</span><span class="token punctuation">:</span> <span class="token string">&quot;-&quot;</span>
</code></pre></div><ul><li><p>defaultNull: 是否空字段（null）返回默认值，默认值如下：</p> <table><thead><tr><th>null字段类型</th> <th>默认值</th></tr></thead> <tbody><tr><td>String</td> <td>&quot;&quot;</td></tr> <tr><td>Array</td> <td>[]</td></tr> <tr><td>Object</td> <td>{}</td></tr> <tr><td>Date</td> <td>&quot;&quot;</td></tr> <tr><td>Double</td> <td>0.0</td></tr> <tr><td>Integer</td> <td>0</td></tr> <tr><td>Map</td> <td>{}</td></tr> <tr><td>BigDecimal</td> <td>0.0</td></tr></tbody></table></li> <li><p>defaultNullValue： 若配置了这个，则全部用此代替空字段（null）的返回默认值</p></li></ul> <p>以上都是对json的全局配置，我们对空值的默认值可以部分定义，如定义在某个需要序列化的类上：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@NullFormat</span><span class="token punctuation">(</span>defaultNull <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> defaultNullValue <span class="token operator">=</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>所有对null值默认值的处理不能对map等非常规bean起作用。如果是部分定义，只对当前类有效，其聚合的类无效。</p></div> <p>若是对于同一个对象需要在不同线程里实现不同的效果，比如查看详情和修改详情对于null值处理不一样，使用如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">DefaultNullContextHolder</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//关闭此次请求/线程对null值序列化的处理</span>
</code></pre></div><h4 id="_6-2-2-自定义序列化"><a href="#_6-2-2-自定义序列化" class="header-anchor">#</a> 6.2.2 自定义序列化</h4> <p>自定义序列化的方式有很多，比如我们使用jackson自带的注解可解决自定义序列化：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@JsonSerialize</span><span class="token punctuation">(</span>using <span class="token operator">=</span> <span class="token class-name">MyJsonSerializer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token class-name">String</span> name<span class="token punctuation">;</span>
</code></pre></div><p>但是我们有很多种格式，比如有些值在转换成亿，有些值要转化成百万，有些要加币种前缀，有些要加单位后缀， 这些如果组合起来，jackson自带的序列化有点力不从心，为此我们扩展了jackson的自定义序列化。如：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SerializerConvert</span><span class="token punctuation">(</span>convertClasses <span class="token operator">=</span> <span class="token class-name">MySerializerConverter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SerializerFormat</span><span class="token punctuation">(</span>newTarget <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> post <span class="token operator">=</span> <span class="token string">&quot;万元&quot;</span><span class="token punctuation">,</span> pre <span class="token operator">=</span> <span class="token string">&quot;$&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> s7 <span class="token operator">=</span> <span class="token number">19000000</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>@SerializerConvert</p> <p>表示数据转换，可定义多个计算与转换，依次执行。比如<code>@SerializerConvert(convertClasses = {MySerializerConverter.class, MySerializerConverter2.class})</code>，类似于一种链式计算。</p></li> <li><p>@SerializerFormat</p> <p>表示数据格式化，将计算后的数据格式化成最终需要展示的格式。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>两个注解可以任意搭配使用，可使用其中一个或多个</p> <p>新生成的key，可以如下配置来定义目标属性的key，用<code>{}</code> 表示占位符</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">mvc</span><span class="token punctuation">:</span>
  <span class="token key atrule">json</span><span class="token punctuation">:</span>
  	<span class="token key atrule">target-filed-key-format</span><span class="token punctuation">:</span> <span class="token string">&quot;{}Name&quot;</span>
</code></pre></div></div></li></ul> <h4 id="_6-2-3-数字格式化"><a href="#_6-2-3-数字格式化" class="header-anchor">#</a> 6.2.3 数字格式化</h4> <p>业务上有很多逻辑运算，运算完了会产生结果，往往不同类型(如int、double)的数据返回的格式不一样，但实际上展示的时候需要统一保留两位或统一格式化。使用<code>@NumberFormat</code>注解：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@NumberFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;#,###,##0.00&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> amount<span class="token punctuation">;</span>
</code></pre></div><ul><li><p>pattern: 格式化格式，若使用了此样式，通过<code>DecimalFormat.format(pattern)</code>去格式化</p></li> <li><p>scale: 保留位数，默认是2</p></li> <li><p>round: 取舍模式，默认4舍五入，参考<code>BigDecimal</code>里的常量</p></li> <li><p>其它注解属性是和<code>@SerializerFormat</code> 一致，所以相当于用一个注解代替了两个注解，减少注解的个数</p></li></ul> <h4 id="_6-2-4-字典序列化"><a href="#_6-2-4-字典序列化" class="header-anchor">#</a> 6.2.4 字典序列化</h4> <p>字典在数据库里表示不同的含义，从数据库里查出的是字典的key，与显示的值有一一对应关系。在实际展示给用户时必须是用户能理解的含义。以往的解决方式是通过在业务里单独处理或数据库查询的时候关联查询，若有新的字典含义可能还需要改代码，给项目带来了风险与不便。</p> <p>Boot Plus提供了解决方法：</p> <ul><li><p>定义字典和字典值。实现<code>DictCollector</code>并暴露给spring，<code>DictCollector</code>是字典收集器，可以收集所有的字典。可以定义多个字典收集器。</p> <p>有两个方法，一个方法是默认的，也是没有国际化的字典，一个是提供国际化的。</p> <ul><li><p><code>findDictAndValues</code></p> <p>没有国际化的字典收集方法，参考代码</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ResourceBundleCollection</span> resourceBundleCollection <span class="token operator">=</span> <span class="token class-name">ResourceBundleCollection<span class="token punctuation">.</span>ResourceBundleCollectionBuilder</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Sting</span> dictKey <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dictValueMap <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

resourceBundleCollection<span class="token punctuation">.</span><span class="token function">putResourceBundle</span><span class="token punctuation">(</span>dictKey<span class="token punctuation">,</span> dictValueMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>findLocaleDictAndValues</code></p> <p>国际化的字典收集方法</p></li> <li><div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">//</span> <span class="token attr-value">开启国际化，默认为false</span>
<span class="token attr-name">mvc.json.enableLocale</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div></li></ul></li> <li><p>使用<code>@DicFormat</code>注解。无需添加其它字段即可实现字段值的显示。</p> <ul><li>dictKey: 字典key，默认为当前属性的名称</li> <li>disableCache 禁用缓存（暂未实现）</li> <li>其它注解属性是和<code>@SerializerFormat</code> 一致，所以相当于用一个注解代替了两个注解，减少注解的个数</li></ul></li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>字典序列化默认采取了缓存策略，若字典key未找到，会从相应的收集器或全部收集器再收集一次，故请在各个收集器里做好缓存策略，避免大面积将查询打到数据库。（已优化：对于同一个线程下若发现未匹配到相应的字典或字典值，不会重复收集）</p></div> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>以上对json的扩展是基于jackson（spring mvc默认序列化）的，若在项目里未使用jackson序列化，无法扩展。</p></div> <h3 id="_6-3-流处理"><a href="#_6-3-流处理" class="header-anchor">#</a> 6.3 流处理</h3> <p>springmvc为我们提供了很好的文件上传的支持。但文件返回未实现。为些我们提供了更方便的文件下载和文件查看。</p> <ul><li>文件下载：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;boot/fileDownload&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileDownloadStreamingResponseBody</span><span class="token punctuation">&gt;</span></span> <span class="token function">fileDownload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FileDownloadStreamingResponseBody</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;xx.pdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token string">&quot;xxx.pdf&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">mediaType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_PDF<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toResponseEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>文件查看：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;boot/fileView&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileViewStreamingResponseBody</span><span class="token punctuation">&gt;</span></span> <span class="token function">fileView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FileViewStreamingResponseBody</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;xx.pdf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">toResponseEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-4-参数校验"><a href="#_6-4-参数校验" class="header-anchor">#</a> 6.4 参数校验</h3> <h4 id="_6-4-1-校验"><a href="#_6-4-1-校验" class="header-anchor">#</a> 6.4.1 校验</h4> <p>校验是指对客户端请求的参数格式或逻辑校验，根据校验校验结果返回给客户端的不同信息。校验分两种：</p> <ul><li><p>手工校验</p> <p>手工校验是指在代码里的业务校验。校验不通过可以抛出校验异常。如：<code>throws new ValidateException(&quot;名称已存在&quot;)</code></p></li> <li><p>自动校验</p> <p>在自动映射的字段上，加上相关的注解，从而实现自动校验。如：<code>@NotEmpty(message=&quot;名称不能为空&quot;)</code></p></li></ul> <h4 id="_6-4-2-自定义校验处理器"><a href="#_6-4-2-自定义校验处理器" class="header-anchor">#</a> 6.4.2 自定义校验处理器</h4> <p>​	通过实现<code>com.alilitech.web.validate.ValidateHandler</code>接口，并实现处理验证异常。此处理器只能有一个，并暴露给spring。</p> <h3 id="_6-5-系统异常处理"><a href="#_6-5-系统异常处理" class="header-anchor">#</a> 6.5 系统异常处理</h3> <p>框架提供了全局默认异常处理：打印异常信息，在头部信息里返回<code>服务器内部错误</code></p> <p>也可以自定义异常处理，实现<code>com.alilitech.web.exception.ExceptionHandler</code>接口，并交给spring管理。</p> <h3 id="_6-6-基于请求的threadlocal管理"><a href="#_6-6-基于请求的threadlocal管理" class="header-anchor">#</a> 6.6 基于请求的ThreadLocal管理</h3> <p>由于线程都是线程池，如果用了ThreadLocal没有清除，有可能会导致错误的结果。我们可以将我们要统一管理的ThreadLocal放置到ThreadLocalContainer中：<code>ThreadLocalContainer.getInstance().addThreadLocal(...)</code></p> <p>我们请求结束后会统一清除相关的值的设置</p> <h2 id="part7-boot-plus-log"><a href="#part7-boot-plus-log" class="header-anchor">#</a> Part7 boot-plus-log</h2> <p>集成了spring-boot-starter-actuator。</p> <h3 id="_7-1-对controller进行切面控制"><a href="#_7-1-对controller进行切面控制" class="header-anchor">#</a> 7.1 对Controller进行切面控制</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">aspect</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>可以控制开启切面是否开启，同时提供了切面控制扩展，可以打印日志或记录日志。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogOptService</span> <span class="token keyword">implements</span> <span class="token class-name">LogExtension</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeEnter</span><span class="token punctuation">(</span><span class="token class-name">Signature</span> signature<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//....</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">afterExit</span><span class="token punctuation">(</span><span class="token class-name">Signature</span> signature<span class="token punctuation">,</span> <span class="token class-name">Object</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//....</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-2-管理日志级别"><a href="#_7-2-管理日志级别" class="header-anchor">#</a> 7.2 管理日志级别</h3> <p>生产环境或测试环境有时候需要debug日志，等调试完后又关闭。访问<code>/log.html</code>在线管理日志级别。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>加了安全控制需要给相关人员赋于权限。相关的url包括<code>GET /management/logs</code>，<code>PUT /management/logs</code></p></div> <h3 id="_7-3-基于线程的日志打印"><a href="#_7-3-基于线程的日志打印" class="header-anchor">#</a> 7.3 基于线程的日志打印</h3> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token attr-name">//</span> <span class="token attr-value">开启基于线程的日志打印，这样同一个请求就可以快速鉴定出来。默认为true</span>
<span class="token attr-name">logging.enableThreadLocal</span><span class="token punctuation">=</span><span class="token attr-value">true</span>
</code></pre></div><h2 id="part8-boot-plus-swagger"><a href="#part8-boot-plus-swagger" class="header-anchor">#</a> Part8 boot-plus-swagger</h2> <p>实现了在线API，主要实现以下功能：</p> <ul><li>集成swaggger</li> <li>统一授权配置</li> <li>每个接口添加参数配置</li> <li>简单导出API</li> <li>对Pageable进行参数改写</li> <li>在线UI（/api.html）</li></ul> <p>可以配置swagger相关配置，如：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token key atrule">title</span><span class="token punctuation">:</span> 接口文档
  <span class="token key atrule">description</span><span class="token punctuation">:</span> 这是在线生成的API文档
  <span class="token key atrule">version</span><span class="token punctuation">:</span> V1.0
  <span class="token key atrule">termsOfServiceUrl</span><span class="token punctuation">:</span>
  <span class="token key atrule">contactName</span> <span class="token punctuation">:</span> David
  <span class="token key atrule">contactUrl</span><span class="token punctuation">:</span> 
  <span class="token key atrule">contactEmail</span><span class="token punctuation">:</span> 
  <span class="token key atrule">license</span><span class="token punctuation">:</span>
  <span class="token key atrule">licenseUrl</span><span class="token punctuation">:</span>
  <span class="token key atrule">defaultIncludePattern</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token string">&quot;/api/.*&quot;</span>
  <span class="token key atrule">apiHost</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8080</span>                      <span class="token comment">#ui上测试操作的时候访问的实际url</span>
  <span class="token key atrule">global</span><span class="token punctuation">:</span>                                      <span class="token comment">#每个接口添加参数，在线API里，每个接口都会体现</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Authorization
      <span class="token key atrule">description</span><span class="token punctuation">:</span> 授权
      <span class="token key atrule">type</span><span class="token punctuation">:</span> string
      <span class="token key atrule">parameterType</span><span class="token punctuation">:</span> header
      <span class="token key atrule">required</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">authorized</span><span class="token punctuation">:</span>                                  <span class="token comment">#统一处理授权</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Authorization
      <span class="token key atrule">in</span><span class="token punctuation">:</span> header
  <span class="token key atrule">authorizedIncludePattern</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;/api/.*&quot;</span>
</code></pre></div><p>defaultIncludePattern： 哪些url的API会在在线文档里显示</p> <p>apiHost：在线测试api时实际访问的API。由于代理映射问题，有时候访问html的地址和访问API的地址是不一致的</p> <p>global：每个接口添加参数，在线API里，每个接口都会体现。数组，可配置多个。</p> <p>authorized：统一授权，会在需要授权的API上加锁，显示需要授权。数组，可配置多个。</p> <p>authorizedIncludePattern： 哪个URL需要授权，逗号隔开</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在实际开发过程中如果有安全控制，也要将以下url分配相关权限：<code>GET /swagger-resources/**</code>, <code>GET /swagger-ui/**</code>, <code>GET /v2/**</code></p></div> <h2 id="part9-boot-plus-security"><a href="#part9-boot-plus-security" class="header-anchor">#</a> Part9 boot-plus-security</h2> <p>集成了spring scurity，但由于spring scurity比较复杂，使用起来比较繁琐，故做了一些减法，对常用的保留，对不常用的暂时去除。若需要其它功能的，请自行集成。</p> <p>此次集成主要实现了以下特性：</p> <ul><li>可快速实现授权与鉴权，无需关注复杂的各种过滤器</li> <li>集成JWT</li> <li>实现Stateful Token（有状态Token）</li> <li>支持多因素认证</li> <li>支持本地缓存和分布式缓存一键切换</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意：由于security模块引入spring cache，所以一定要配置cache名称：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
<span class="token key atrule">cache</span><span class="token punctuation">:</span>
 <span class="token key atrule">cache-names</span><span class="token punctuation">:</span>
 	<span class="token punctuation">-</span> security
</code></pre></div></div> <h3 id="_9-1-jwt"><a href="#_9-1-jwt" class="header-anchor">#</a> 9.1 JWT</h3> <p>在Spring Scurity基本上实现无状态的JWT Token。主要实现以下功能：</p> <ul><li>分离授权和鉴权</li> <li>用户可自定义扩展生成Token，校验Token</li> <li>用户可自定义扩展登陆成功，登陆失败，登出成功，根据登陆key查用户</li> <li>用户可自定义解析拿到Token，解析根据请求（uri）拿到资源（resource）对应的角色</li> <li>用户可自定义鉴权失败的返回</li> <li>登出Token黑名单功能（利用缓存，用户可自定义缓存）</li> <li>自动刷新Token(由于是无状态的，所以在Token快失效时，返回一个新的Token)</li></ul> <p>对于其它配置可以通过以下配置来实现</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">security</span><span class="token punctuation">:</span>
  <span class="token key atrule">token</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> JWT
    <span class="token key atrule">ignorePatterns</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> <span class="token key atrule">pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;/*.ico&quot;</span>
        <span class="token key atrule">method</span><span class="token punctuation">:</span> GET
      <span class="token punctuation">-</span> <span class="token key atrule">pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;/css/**&quot;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;/fonts/**&quot;</span>
    <span class="token key atrule">permitAllPatterns</span><span class="token punctuation">:</span> 
    <span class="token key atrule">permitAllUserNames</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> admin
    <span class="token key atrule">bizUserClassName</span><span class="token punctuation">:</span> 
    <span class="token key atrule">authenticationPrefix</span><span class="token punctuation">:</span> <span class="token string">&quot;/authentication&quot;</span>
    <span class="token key atrule">jwt</span><span class="token punctuation">:</span>
      <span class="token key atrule">secret</span><span class="token punctuation">:</span>                    <span class="token comment"># 加密串</span>
      <span class="token key atrule">timeoutMin</span><span class="token punctuation">:</span>                <span class="token comment"># Token超时, 单位：分钟</span>
      <span class="token key atrule">refreshSeconds</span><span class="token punctuation">:</span>            <span class="token comment"># Token还有多久失败时刷新Token， 单位：秒</span>
</code></pre></div><p>type：目前支持JWT，ST</p> <p><strong>ignorePatterns： 哪些url不需要授权和鉴权，这些url拿不到上下文</strong></p> <p><strong>permitAllPatterns：哪些url，所有用户都有权限</strong></p> <p><strong>permitAllUserNames： 哪些用户有全部url的权限</strong></p> <p><strong>authenticationPrefix: 认证（登录、登出）uri前缀</strong></p> <p>bizUserClassName:  需要存储的业务用户类全路径名，默认是BizUser.class.getName()</p> <p>jwt.secret: 加密串</p> <p>jwt.timeoutMin:  Token超时, 单位：分钟</p> <p>jwt.refreshSeconds: Token还有多久失败时刷新Token， 单位：秒</p> <h3 id="_9-2-stateful-token-有状态token"><a href="#_9-2-stateful-token-有状态token" class="header-anchor">#</a> 9.2 Stateful Token（有状态token)</h3> <p>在spring Scurity 基础上实现了有状态的token, token对应的用户信息在缓存里存储。</p> <p>配置如下：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">security</span><span class="token punctuation">:</span>
  <span class="token key atrule">token</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> ST
    <span class="token key atrule">ignorePatterns</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> <span class="token key atrule">pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;/*.ico&quot;</span>
        <span class="token key atrule">method</span><span class="token punctuation">:</span> GET
      <span class="token punctuation">-</span> <span class="token key atrule">pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;/css/**&quot;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">pattern</span><span class="token punctuation">:</span> <span class="token string">&quot;/fonts/**&quot;</span>
    <span class="token key atrule">permitAllPatterns</span><span class="token punctuation">:</span> 
    <span class="token key atrule">permitAllUserNames</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> admin
    <span class="token key atrule">bizUserClassName</span><span class="token punctuation">:</span> 
    <span class="token key atrule">authenticationPrefix</span><span class="token punctuation">:</span> <span class="token string">&quot;/authentication&quot;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>两种风格只需要切换配置即可。</p></div> <h3 id="_9-3-如何开发"><a href="#_9-3-如何开发" class="header-anchor">#</a> 9.3 如何开发</h3> <ul><li><p>登录url</p> <p>${authenticationPrefix}/login</p></li> <li><p>登出uri</p> <p>${authenticationPrefix}/logout</p></li> <li><p>开发者扩展类<code>ExtensibleSecurity</code></p> <p><strong>用户用这个一个类可实现自定义认证授权与鉴权部分</strong></p> <ul><li><p>validTokenExtension: 校验token扩展，可自定义校验Token扩展，也可以刷新缓存期限</p></li> <li><p>loginSuccess: 登录成功处理</p></li> <li><p>loginFailure: 登录失败处理</p></li> <li><p>logoutSuccess: 登出成功处理</p></li> <li><p>loadUserByUsername:</p> <p>为用户名和密码方式的认证提供方法。</p> <p>根据用户名加载信息，包括用户名，密码。若需要鉴权的用户则需要加入角色信息</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span>maxAuth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BizUser</span> bizUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BizUser</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bizUser<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> roleCodes <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token class-name">BizUser</span> bizUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BizUser</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> roleCodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bizUser<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>resolveToken 根据请求解析Token</p></li> <li><p>obtainResource 根据request（资源）获得关联的角色信息，以验证此用户是否有权限</p></li> <li><p>authorizationFailure 鉴权失败处理</p></li> <li><p>addVirtualFilterDefinitions</p> <p>我们可能有这样的需求，一个认证请求会同时验证好多数据，比如登陆时附带验证码的时候，我们需要先验证验证码，再验证用户名和密码（多因素认证，不是多次认证）。我们可以定义多个<code>VirtualFilterDefinition</code>，如：</p> <div class="language-java extra-class"><pre class="language-java"><code>virtualFilterDefinitions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">VirtualFilterDefinition</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">supportedPredicate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    		<span class="token comment">// 此filter是否支持验证判断</span>
            <span class="token class-name">AntPathRequestMatcher</span> requestMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AntPathRequestMatcher</span><span class="token punctuation">(</span><span class="token string">&quot;/authentication/login&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">RequestMatcher<span class="token punctuation">.</span>MatchResult</span> matcher <span class="token operator">=</span> requestMatcher<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> matcher<span class="token punctuation">.</span><span class="token function">isMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticationFunction</span><span class="token punctuation">(</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    		<span class="token comment">// 如何验证，验证失败时可以抛出AuthenticationException</span>
            <span class="token class-name">String</span> code <span class="token operator">=</span> servletRequest<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">&quot;验证码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">(</span>authentication<span class="token punctuation">,</span> servletRequest<span class="token punctuation">,</span> servletResponse<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>	
    		<span class="token comment">// 此filter认证成功后，是否结束整个流程的认证</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">alias</span><span class="token punctuation">(</span><span class="token string">&quot;验证码验证&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//别名，在日志里会看到经过了哪些filter</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这些定义的filter会在用户名和密码认证的filter之前。用户名和密码的认证filter，只支持post请求。</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>VirtualFilterDefinition</code> 提供了构建Authentication的方法</p></div></li></ul></li> <li><p>authenticationExtension 授权原始框架扩展，默认情况下实现以下功能</p> <ul><li>开启跨域支持</li> <li>session管理禁用</li> <li>csrf 禁用</li></ul></li> <li><p>authorizationExtension 鉴权原始框架扩展，默认情况下实现以下功能</p> <ul><li>开启跨域支持</li> <li>session管理禁用</li> <li>csrf 禁用</li> <li>anonymous 禁用</li> <li>securityContext 禁用</li> <li>requestCache 禁用</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>对于<code>authenticationExtension</code> 和<code>authorizationExtension</code>原始默认实现功能不符合要求，可完全覆盖默认实现</p></div> <h2 id="part10-boot-plus-cache"><a href="#part10-boot-plus-cache" class="header-anchor">#</a> Part10 boot-plus-cache</h2> <p>spring cache为我们提供了多个缓存的抽象，我们只要调用cacheManager就可以操作不同的缓存，但并未提供缓存的tti、ttl的抽象。本模块致力于提供缓存的tti、ttl抽象。目前支持caffeine和redis。这样我们在本地开发的时候可以使用caffeine，不需要依赖redis。上生产可以切换成基于redis分布式缓存。</p> <p>操作缓存的类<code>CacheTemplate</code>。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/boot-plus/assets/js/app.21260ec8.js" defer></script><script src="/boot-plus/assets/js/2.7b2df435.js" defer></script><script src="/boot-plus/assets/js/12.24b48ba6.js" defer></script>
  </body>
</html>
